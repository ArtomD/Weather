package com.servlets;

import com.servlets.*;
import javax.servlet.*;
import javax.servlet.http.*;
import java.io.*;
import java.util.*;

public class WeatherServlet extends HttpServlet {

	private String target = "/Results.jsp";

	public void init(ServletConfig config) throws ServletException {
		super.init(config);
	}

	public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		BufferedReader br = new BufferedReader(new InputStreamReader(request.getInputStream()));
        String value = "";
        if(br != null){
            value = br.readLine();
        }

		SOAPController Controller = new SOAPController(value);
		Day[] Days = Controller.getAllData();
		String json = "{\"days\":[";
		for(int i = 0; i<Days.length;i++){
			json = json + Days[i].getJson();
			if(i<(Days.length-1)){
				json = json + ",";
				System.out.println();
			}else{
				json = json + "]}";
				
			}
		}
         
		response.setContentType("text/plain");
		response.getWriter().write(json);
	}

	public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		BufferedReader br = new BufferedReader(new InputStreamReader(request.getInputStream()));		
		String value = "";
        if(br != null){
            value = br.readLine();
        }

		SOAPController Controller = new SOAPController(value);
		Day[] Days = Controller.getAllData();
		String json = "{\"days\":[";
		for(int i = 0; i<Days.length;i++){
			json = json + Days[i].getJson();
			if(i<(Days.length-1)){
				json = json + ",";
				System.out.println();
			}else{
				json = json + "]}";
				
			}
		}
         
		response.setContentType("text/plain");
		response.getWriter().write(json);
		
	} 
	public void destroy() {
	}	
}
